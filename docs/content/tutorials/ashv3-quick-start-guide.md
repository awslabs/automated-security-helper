# ASHv3 - Quick Start Guide

> Last update: 2025-05-13

- [Overview](#overview)
- [Installation](#installation)
  - [1. (Fastest + Recommended) Using `ash` as a shell alias with `uvx`](#1-fastest--recommended-using-ash-as-a-shell-alias-with-uvx)
    - [sh, bash, zsh, fish, etc](#sh-bash-zsh-fish-etc)
    - [PowerShell](#powershell)
  - [2. Installing in an insolated venv with `pipx`](#2-installing-in-an-insolated-venv-with-pipx)
  - [3. Installing with `pip`](#3-installing-with-pip)
  - [4. Clone the ASH repository](#4-clone-the-ash-repository)
    - [sh, bash, zsh, fish, etc](#sh-bash-zsh-fish-etc-1)
      - [Using the Python entrypoint](#using-the-python-entrypoint)
    - [PowerShell](#powershell-1)
      - [Using the Python entrypoint](#using-the-python-entrypoint-1)
- [Running ASH](#running-ash)
  - [Changing the `--mode` of ASH](#changing-the---mode-of-ash)


## Overview

This guide provides different options for quickly running ASHv3 locally based on the tools you have available on your machine.

Here are the largest changes with ASHv3 to be aware of that affect how you run ASH:

1. ASH has been entirely rewritten in Python.
    1. There is now a Python-based CLI entrypoint that will be the primary entrypoint recommended in documentation.
    2. The existing `ash` shell script entrypoint will still exist and be supported as a first class entrypoint for the foreseeable future, so any scripts or automation currently invoking ASH this way should remain functional with ASHv3.
    3. Using the new `--mode` argument when running `ash` will allow you to specify running in `container` or `local` mode. As the values suggest, specifying `--mode container` will build and run the ASH container image and requires a container engine
2. ASH uses a new `.ash/` directory as the default output path if there is no explicit path provided.
    1. The default path for output before was `ash_output` in the same directory as the source-dir.
    2. Due to supporting new configuration options and a broader number of outputs, ASH now uses a new centralized `.ash` directory in the source directory as its default home for configuration and outputs, with the default output-dir being `.ash/ash_output`. If you are explicitly passing `--output-dir some/other/dir` when calling ASH, then you should not be affected with ASH v3 and your expected paths should continue working for target output location.
3. ASH produces significantly different output.
    1. There is no longer an `aggregated_results.txt` emitted that contains the entirety of the stdout/stderr output from each tool. If you are using a custom parser that extracted findings and metrics from the aggregated results TXT file, that will no longer function as expected when moving to ASHv3.
    2. The closest files with v3 would be...
        1. `.ash/ash_output/ash_aggregated_results.json`: This JSON file contains ALL of the output from the run and can be used with ASHv3 to generate any supported report with ASH without requiring a new scan to be executed. This is meant to be machine readable so it can reproduce reports reliably, but can still be explored relatively easily.
        2. `.ash/ash_output/reports/ash.summary.txt`: This TXT file is generated by the TextReporter built into ASHv3 and is a human-readable summary that is intended to be `cat`'d in a terminal for inspection after a run has completed.
        3. `.ash/ash_output/reports/ash.summary.md`: This Markdown file is generated by the MarkdownReporter built into ASHv3 and is a human-readable summary that is intended to be `cat`'d in a terminal for inspection after a run has completed. This formats well with Markdown engines, including GitHub Pull Request comments and GitHub Actions Markdown Summary, Visual Studio Code's Markdown Preview, etc.
        4. `.ash/ash_output/reports/ash.html`: This HTML report can be opened in your browser or any HTML viewer for easy reviewing of the full list of findings in your ASH results.
        5. `.ash/ash_output/reports/ash.csv`: This CSV report of the flattended findings list allows easy sorting and filtering as you work through addressing any issues detected by ASH.

## Installation

Callouts:

- At the time of writing this guide, the v3 changes are still in the `beta` branch, so you may see references to `beta` throughout. Our goal is to have ASHv3 released by re:Inforce this year (e.g. by June!) with a tag corresponding to the release version (expect the tag to be `v3.0.0`)
- Each of the installation options below assumes a variable named `$ASH_VERSION` exists at runtime and contains the branch/tag of the ASH GitHub repo that you would like to use. Some options include handling and default setting. Please use the method that works best for you.

### 1. (Fastest + Recommended) Using `ash` as a shell alias with `uvx`

Prerequisites:

- Python 3.10+
- `uv`: https://docs.astral.sh/uv/getting-started/installation/


> _Note: There are separate entrypoints for alias creation depending on the shell you are using. Below are common examples._
> _Ultimately, the goal would be to abstract calling `uvx git+https://github.com/awslabs/automated-security-helper.git@${ASH_VERSION}` as appropriate for your shell._


#### sh, bash, zsh, fish, etc

```sh
alias ash="uvx git+https://github.com/awslabs/automated-security-helper.git@${ASH_VERSION}"

# Use as normal
ash --help
```

#### PowerShell

```ps1
function ash {
  [CmdletBinding()]
  Param(
    [parameter()]
    [string]
    $AshVersion = $(if ($env:ASH_VERSION) {$env:ASH_VERSION} else {'beta'}),
    [parameter(ValueFromRemainingArguments,Position=0)]
    [string[]]
    $AshArgs
  )
  Invoke-Expression "uvx git+https://github.com/awslabs/automated-security-helper.git@$AshVersion $AshArgs"
}

# Use as normal
ash --help
```

### 2. Installing in an insolated venv with `pipx`

Prerequisites:

- Python 3.10+
- `pipx`: https://pipx.pypa.io/stable/installation/

> _Same instructions for all shells._

```sh
pipx install git+https://github.com/awslabs/automated-security-helper.git@${ASH_VERSION}

# Use as normal
ash --help
```

### 3. Installing with `pip`

Prerequisites:

- Python 3.10+
- `pip`: https://pip.pypa.io/en/stable/installation/

> _Same instructions for all shells._

```sh
pip install git+https://github.com/awslabs/automated-security-helper.git@${ASH_VERSION}

# Use as normal
ash --help
```

### 4. Clone the ASH repository

Prerequisites:

- Python 3.10+
- `git`: https://git-scm.com/downloads
- `pip`: https://pip.pypa.io/en/stable/installation/

#### sh, bash, zsh, fish, etc

##### Using the Python entrypoint

```sh
export ASH_REPO_DIR=${ASH_REPO_DIR:-$HOME/Downloads/ash_repo}
export ASH_VERSION=${ASH_VERSION:-beta}
if [ ! -d "${ASH_REPO_DIR}" ]; then
  git clone https://github.com/awslabs/automated-security-helper.git --branch ${ASH_VERSION} ${ASH_REPO_DIR}
fi
git -C ${ASH_REPO_DIR} pull
pip install ${ASH_REPO_DIR}

# Use as normal
ash --help
```

#### PowerShell

##### Using the Python entrypoint

```ps1
$env:ASH_REPO_DIR = $(if ($env:ASH_REPO_DIR) {$env:ASH_REPO_DIR} else {"$HOME/Downloads/ash_repo"})
$env:ASH_VERSION = $(if ($env:ASH_VERSION) {$env:ASH_VERSION} else {"beta"})
if (-not (Test-Path $env:ASH_REPO_DIR)) {
  git clone https://github.com/awslabs/automated-security-helper.git --branch $env:ASH_VERSION $env:ASH_REPO_DIR
}
git -C ${ASH_REPO_DIR} pull
pip install ${ASH_REPO_DIR}

# Use as normal
ash --help

# Run a scan locally in pure Python
ash --mode local

# Run a scan inside a container with all dependencies
ash --mode container
```

## Running ASH

Whether running ASH in a container, via the `ash` shell script, or in Python directly,
calling `ash` largely remains the same. There are plenty of new options and arguments
surfaced, but common arguments like `--source-dir` and `--output-dir` are still supported
and should continue to function the same as previously.



### Changing the `--mode` of ASH

If you have installed ASH via Python (pip, pipx, uvx), ASH will run in "local mode" by default.
This just means that it runs entirely locally on the machine invoking it without a container.
If you would like to run in a container, include the `--mode` argument and specify
`container` mode, like so:

```sh
ash --mode container
```

Note: we are making changes and may adjust this default before launch! If you would like
to safeguard your scripts to use local mode, please be explicit and set the mode:

```sh
ash --mode local
```

The 3rd mode is `precommit`, which runs primarily Python native scanners (+ npm audit) and includes only ASH plugins
that are known to run quickly, e.g.

- bandit
- detect-secrets
- checkov
- cdk-nag
- npm-audit (_only if the dependencies to run `npm/yarn/pnpm audit` are available_)

> If you are using the simple-scan pre-commit hook from the ASH repository, this mode is set for you automatically!

```sh
ash --mode precommit
```
