#checkov:skip=CKV2_GHA_1:The permissions are not set to write-all at the top-level, or any level
name: Run ASH
on:
  push:
    branches:
      - "*"
    tags:
      - "*"
  pull_request:
    branches:
      - "*"
  workflow_dispatch: {}
env:
  PYTHON_VERSION: "3.12"
jobs:
  ash:
    permissions:
      #checkov:skip=CKV2_GHA_1:The permissions are not set to write-all at the top-level, or any level
      contents: read # Required to read the repository contents in order to scan them with ASH
      checks: write # Required for writing CI check runs
      pull-requests: write # Required for writing comments with scan results to pull requests
      security-events: write # Required for collection of SARIF code scanning results for GitHub Advanced Security checks
    uses: awslabs/automated-security-helper/.github/workflows/run-ash-security-scan.yml@beta
    with:
      ash-version: ${{ github.head_ref || github.ref_name }}
      fail-on-findings: false
      post-pr-comment: true
      repository-owner: ${{ github.repository_owner }}
      verbose: true
      python-version: '3.12'
      ash-mode: container
      ash-args: '--inspect'
